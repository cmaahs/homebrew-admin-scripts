#!/usr/bin/env bash

WINDOW_TITLE=${1:-$(new-codename)}
GUID=$(uuidgen)
RUN_DMC=${2}

cat > ~/Library/ApplicationSupport/iTerm2/DynamicProfiles/${WINDOW_TITLE} <<EOT
{
  "Profiles": [
    {
      "Custom Window Title" : "${WINDOW_TITLE}",
      "Name" : "${WINDOW_TITLE}",
      "Use Custom Window Title" : true,
      "Guid" : "${GUID}"
    }
  ]
}
EOT

if [[ -n ${RUN_DMC} ]]; then
    QUERY=".Profiles[0].\"Initial Text\" += \"${RUN_DMC}\""
    cat <<< $(jq 'QUERY' ~/Library/ApplicationSupport/iTerm2/DynamicProfiles/${WINDOW_TITLE}) > ~/Library/ApplicationSupport/iTerm2/DynamicProfiles/${WINDOW_TITLE}
fi

ls -1 ~/Library/ApplicationSupport/iTerm2/DynamicProfiles
